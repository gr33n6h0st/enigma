<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATION X | ENIGMA M3</title>
    <style>
        :root {
            --alert-red: #ff3e3e;
            --paper: #d2c5a2;
            --metal: #1a1b1e;
            --army-green: #3d441e;
            --glow: #00ff41;
        }

        body {
            background-color: #050505;
            color: var(--paper);
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .war-room-border {
            border: 10px double #333;
            padding: 30px;
            max-width: 850px;
            background: radial-gradient(circle, #1a1b1e 0%, #000 100%);
            box-shadow: 0 0 100px rgba(0,0,0,1);
        }

        .header-meta {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--army-green);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--army-green);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .timer-unit {
            color: var(--alert-red);
            font-size: 1.5rem;
            text-shadow: 0 0 10px var(--alert-red);
        }

        .enigma-chassis {
            background: #222;
            padding: 25px;
            border-radius: 4px;
            border: 4px solid #111;
            box-shadow: inset 0 0 20px #000;
        }

        /* The Lamps */
        .lampboard {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 12px;
            margin: 25px 0;
            padding: 20px;
            background: #0a0a0a;
            border-radius: 8px;
        }

        .lamp {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #222;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            color: #222;
            transition: 0.05s;
            background: #111;
        }

        .lamp.on {
            background: #fffbe6;
            color: #000;
            box-shadow: 0 0 30px 5px #fffbe6, inset 0 0 10px #ffdf00;
            border-color: #fff;
        }

        .rotor-display {
            background: #000;
            color: var(--glow);
            font-size: 2rem;
            padding: 10px 20px;
            border: 2px solid var(--army-green);
            display: inline-block;
            margin-bottom: 20px;
            font-family: 'Courier', monospace;
        }

        input#operator-input {
            width: 100%;
            background: #000;
            border: 1px solid #333;
            color: var(--glow);
            padding: 15px;
            font-size: 1.2rem;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 10px;
            outline: none;
        }

        .paper-tape {
            background: var(--paper);
            color: #111;
            padding: 20px;
            margin-top: 30px;
            font-weight: 900;
            min-height: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            border-left: 8px solid #b1a27e;
            position: relative;
        }

        .paper-tape::after {
            content: "OFFICIAL INTERCEPT";
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 0.6rem;
            color: rgba(0,0,0,0.2);
        }

        .manual-trigger {
            margin-top: 20px;
            text-align: center;
            font-size: 0.7rem;
            color: var(--army-green);
        }
    </style>
</head>
<body>

    <div class="war-room-border">
        <div class="header-meta">
            <div>DEPT: BLETCHLEY PARK / GC&CS</div>
            <div class="timer-unit" id="timer">00:00:00</div>
        </div>

        <div class="enigma-chassis">
            <div style="text-align: center;">
                <div style="font-size: 0.7rem; margin-bottom: 5px;">ROTOR SETTING</div>
                <div class="rotor-display" id="rotorVal">00</div>
            </div>

            <div class="lampboard" id="lampboard"></div>

            <input type="text" id="operator-input" placeholder="INPUT TELEPRINTER DATA" autofocus autocomplete="off">
            
            <div class="manual-trigger">
                [SYSTEM ACTIVE] - USE KEYBOARD TO OPERATE - BACKSPACE REVERSES ROTORS
            </div>
        </div>

        <div class="paper-tape" id="tape">
            TRANSCRIPT >> 
        </div>
    </div>

    <script>
        const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const rotorWiring = "EKMFLGDQVZNTOWYHXUSPAIBRCJ";
        const reflector = "YRUHQSLDPXNGOKMIEBFZCWVJAT";
        
        let rotorPos = 0;
        const lampboard = document.getElementById('lampboard');
        const input = document.getElementById('operator-input');
        const tape = document.getElementById('tape');
        const rotorDisp = document.getElementById('rotorVal');

        // Initialize Lamps
        alphabet.split("").forEach(char => {
            const div = document.createElement('div');
            div.className = 'lamp';
            div.id = `lamp-${char}`;
            div.innerText = char;
            lampboard.appendChild(div);
        });

        function process(char) {
            let idx = alphabet.indexOf(char);
            
            // Forward pass
            let forwardIdx = (idx + rotorPos) % 26;
            let forwardChar = rotorWiring[forwardIdx];
            
            // Reflector
            let refIdx = alphabet.indexOf(forwardChar);
            let reflectedChar = reflector[refIdx];
            
            // Reverse pass
            let revIdx = rotorWiring.indexOf(reflectedChar);
            let finalIdx = (revIdx - rotorPos + 26) % 26;
            
            return alphabet[finalIdx];
        }

        input.addEventListener('keydown', (e) => {
            if (e.key === "Backspace") {
                if (tape.innerText.length > 14) {
                    tape.innerText = tape.innerText.slice(0, -1);
                    rotorPos = (rotorPos - 1 + 26) % 26;
                    rotorDisp.innerText = rotorPos.toString().padStart(2, '0');
                }
                return;
            }

            const key = e.key.toUpperCase();
            if (alphabet.includes(key)) {
                const result = process(key);

                // Lamp Animation
                document.querySelectorAll('.lamp').forEach(l => l.classList.remove('on'));
                document.getElementById(`lamp-${result}`).classList.add('on');

                // Update UI
                tape.innerText += result;
                rotorPos = (rotorPos + 1) % 26;
                rotorDisp.innerText = rotorPos.toString().padStart(2, '0');
            }
            e.preventDefault();
            input.value = ""; // Keep input clear
        });

        // Timer
        let seconds = 0;
        setInterval(() => {
            seconds++;
            let m = Math.floor(seconds / 60).toString().padStart(2, '0');
            let s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `00:${m}:${s}`;
        }, 1000);
    </script>
</body>
</html>
